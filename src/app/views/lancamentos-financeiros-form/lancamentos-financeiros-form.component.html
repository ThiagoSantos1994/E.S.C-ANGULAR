<!DOCTYPE html>
<html>

<head>
  <title>Font Awesome Icons</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <div class="col-auto">
      <i class="fa fa-line-chart" style="font-size:24px"></i>
    </div>

    <h5>Minhas Despesas Mensais</h5>

    <hr>
    <div class="d-grid gap-2 d-md-block btn-group-sm">
      <div class="btn-group mr-2" role="group" aria-label="First group">
        <button class="btn text-white" data-mdb-ripple-init style="background-color: #3e0068;" href="#!" role="button"
          title="Processar Importação" (click)="processarImportacao()">
          <i class="fas fa-cloud-download-alt"></i>
        </button>
        <button class="btn text-white" data-mdb-ripple-init style="background-color: #690303;" href="#!" role="button"
          title="Excluir Tudo" (click)="excluirTodosLancamentos()">
          <i class="fas fa-trash-alt"></i>
        </button>
      </div>
    </div>

    <div class="row" [formGroup]="pesquisaForm">
      <div class="col-lg-6 col-md-3 col-sm-12 p-0.3">
        <select class="form-control search-slt" formControlName="cbMes">
          <option value="01">Janeiro</option>
          <option value="02">Fevereiro</option>
          <option value="03">Março</option>
          <option value="04">Abril</option>
          <option value="05">Maio</option>
          <option value="06">Junho</option>
          <option value="07">Julho</option>
          <option value="08">Agosto</option>
          <option value="09">Setembro</option>
          <option value="10">Outubro</option>
          <option value="11">Novembro</option>
          <option value="12">Dezembro</option>
        </select>
      </div>
      <div class="col-lg-4 col-md-3 col-sm-12 p-0">
        <select class="form-control search-slt" formControlName="cbAno">
          <option value="2024">2024</option>
          <option value="2023">2023</option>
          <option value="2022">2022</option>
          <option value="2021">2021</option>
          <option value="2020">2020</option>
          <option value="2019">2019</option>
          <option value="2018">2018</option>
          <option value="2017">2017</option>
          <option value="2016">2016</option>
        </select>
      </div>

      <div class="col-lg-2 col-md-3 col-sm-12 p-0">
        <button type="button" class="btn btn-primary wrn-btn" (click)="carregarDespesas()">
          <i class="fas fa-search"></i>
        </button>
      </div>
    </div>
  </nav>

  <header id="header">
    <div class="row">
      <!-- Saldo Positivo Mês -->
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-left-receita shadow h-100 py-0">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-4">
                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                  Receita</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">R$ {{lancamentosFinanceiros$.vlSaldoPositivo}}</div>
              </div>
              <div class="col-auto">
                <i class="fa fa-dollar fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Despesas -->
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-left-despesas shadow h-100 py-0">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-1">
                <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                  Despesas</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">R$ {{lancamentosFinanceiros$.vlTotalDespesas}}</div>
              </div>
              <div class="col-auto">
                <i class="fas fa-calendar fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Á Pagar -->
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-left-pendente shadow h-100 py-0">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-1">
                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                  Á Pagar</div>
                <div class="h5 mb-0 font-weight-bold text-gray-800">R$
                  {{lancamentosFinanceiros$.vlTotalPendentePagamento}}</div>
              </div>
              <div class="col-auto">
                <i class="far fa-handshake fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Disponivel -->
      <div class="col-xl-3 col-md-6 mb-3">
        <div class="card border-left-disponivel shadow h-100 py-0">
          <div class="card-body">
            <div class="row no-gutters align-items-center">
              <div class="col mr-1">
                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">Saldo Disponível
                </div>
                <div *ngIf="lancamentosFinanceiros$.statusSaldoMes == 'Negativo'"
                  class="h5 mb-0 font-weight-bold text-danger">
                  R$ {{lancamentosFinanceiros$.vlSaldoDisponivelMes}}
                </div>

                <div *ngIf="lancamentosFinanceiros$.statusSaldoMes == 'Positivo'"
                  class="h5 mb-0 font-weight-bold text-gray-800">R$
                  {{lancamentosFinanceiros$.vlSaldoDisponivelMes}}
                </div>
              </div>
              <div class="col-auto">
                <i class="fa fa-pie-chart fa-2x text-gray-300"></i>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="labelQuitacaoMes">
      <span class="badge badge-info d-inline">
        <i class="fas fa-bullhorn"></i>
      </span>
      <span> {{lancamentosFinanceiros$.labelQuitacaoParcelasMes}}</span>
    </div>
  </header>

  <body class="body">
    <div class="card">
      <div class="p-2 text-center bg-light">
        <div class="row">

          <!-- Tabela Lancamentos Fixos Mensais -->
          <div class="col-sm-4">
            <table class="table table-receita">
              <thead class="thead-light">
                <tr>
                  <th scope="col">Descrição Receita</th>
                  <th scope="col">Valor R$</th>
                  <th scope="col">Opções</th>
                </tr>
              </thead>
              <tbody class="customtable">
                <tr *ngFor="let despesasFixas of lancamentosFinanceiros$.despesasFixasMensais">
                  <td class="text-left">
                    <span *ngIf="despesasFixas.tpStatus == '+'" class="font-color-receita-positiva">
                      <span class="badge badge-success d-inline">
                        <i class="fas fa-plus"></i>
                      </span>
                      {{ despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == '-'" class="font-color-receita-negativa">
                      <span class="badge badge-danger d-inline">
                        <i class="fas fa-minus"></i>
                      </span>
                      {{ despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == '< i >'" class="font-color-receita-anotacao">
                      <span class="badge badge-info d-inline">
                        <i class="far fa-sticky-note"></i>
                      </span>
                      {{despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == 'P(+)'" class="font-color-poupanca-positiva">
                      <span class="badge badge-info d-inline" style="background-color: #3b6bd3">
                        <i class="fa fa-key"></i>
                      </span>
                      {{despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == 'P(-)'" class="font-color-poupanca-negativa">
                      <span class="badge badge-info d-inline" style="background-color: #ee5569">
                        <i class="fa fa-key"></i>
                      </span>
                      {{despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == '->'" class="font-color-receita-adiantada">
                      <span class="badge badge-info d-inline" style="background-color: #e98c00">
                        <i class="fa fa-share"></i>
                      </span>
                      {{despesasFixas.dsDescricao }}
                    </span>

                    <span *ngIf="despesasFixas.tpStatus == '< X >'" class="font-color-linha-separacao">
                      {{ despesasFixas.dsDescricao }}
                    </span>
                  </td>

                  <td>
                    <span *ngIf="despesasFixas.tpStatus == '+'" class="font-color-receita-positiva">{{
                      despesasFixas.vlTotal }}</span>
                    <span *ngIf="despesasFixas.tpStatus == '-'" class="font-color-receita-negativa">{{
                      despesasFixas.vlTotal }}</span>
                    <span *ngIf="despesasFixas.tpStatus == '< i >'" class="font-color-receita-anotacao">{{
                      despesasFixas.vlTotal }}</span>
                    <span *ngIf="despesasFixas.tpStatus == '< X >'" class="font-color-linha-separacao">
                      {{ despesasFixas.vlTotal }}
                    </span>
                    <span *ngIf="despesasFixas.tpStatus == 'P(+)'" class="font-color-poupanca-positiva">
                      {{ despesasFixas.vlTotal }}
                    </span>
                    <span *ngIf="despesasFixas.tpStatus == 'P(-)'" class="font-color-poupanca-negativa">
                      {{ despesasFixas.vlTotal }}
                    </span>
                    <span *ngIf="despesasFixas.tpStatus == '->'" class="font-color-receita-adiantada">
                      {{ despesasFixas.vlTotal }}
                    </span>
                  </td>

                  <td class="text-left">
                    <button *ngIf="despesasFixas.tpStatus == '< X >'" type="button" disabled
                      class="btn btn-link btn-sm px-0">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button *ngIf="despesasFixas.tpStatus != '< X >'" type="button" class="btn btn-link btn-sm px-0"
                      data-toggle="modal" data-target="#modalCriarEditarReceita"
                      (click)="editarReceitaSelecionada(despesasFixas)" title="Editar receita">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-link btn-sm px-0" title="Excluir receita"
                      (click)="onReceitaSelecionada(despesasFixas)">
                      <i class="far fa-calendar-times"></i>
                    </button>
                    <button type="button" class="btn btn-link btn-sm px-0" title="Subir item"
                      (click)="subirLinhaReceita(despesasFixas)">
                      <i class="fa fa-chevron-up"></i>
                    </button>
                    <button type="button" class="btn btn-link btn-sm px-0" title="Descer item"
                      (click)="descerLinhaReceita(despesasFixas)">
                      <i class="fa fa-chevron-down"></i>
                    </button>
                  </td>
                </tr>
                <tr>
                  <td colspan="8">
                    <br>
                    <div class="d-grid gap-2 d-md-block btn-group-sm">
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #3b6bd3;" href="#!"
                        role="button" data-toggle="modal" (click)="resetModalCriarEditarReceita()"
                        data-target="#modalCriarEditarReceita">
                        <span *ngIf="lancamentosFinanceiros$.vlSaldoDisponivelMes =='0,00'">
                          <i class="fas fa-plus"></i> Criar Nova Receita
                        </span>
                        <span *ngIf="lancamentosFinanceiros$.vlSaldoDisponivelMes !='0,00'">
                          <i class="fas fa-plus"></i> Adicionar
                        </span>
                      </button>
                    </div>
                  <td></td>
                  <td></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Tabela Despesas Mensais -->
          <div class="col-sm-8">
            <table class="table table-despesas" id="tableDespesasMensais">
              <thead class="thead-light">
                <tr>
                  <!--<th class="text-center sorting_asc" rowspan="1" colspan="1" aria-label="" style="width: 19.8889px;">
                    <input type="checkbox" name="item[]" value="s" onclick="marcarTodos(this)">
                  </th>-->
                  <th></th>
                  <th scope="col">Total R$</th>
                  <th scope="col">%</th>
                  <th scope="col">Descrição Despesa</th>
                  <th scope="col">STATUS</th>
                  <th scope="col">PAGO R$</th>
                  <th scope="col"></th>
                </tr>
              </thead>
              <tbody *ngIf="lancamentosFinanceiros$.lancamentosMensais">
                <tr *ngFor="let despesa of lancamentosFinanceiros$.lancamentosMensais">
                  <th>
                    <label class="checkbox-wrap checkbox-primary">
                      <input type="checkbox" name="item[]"
                        (click)="onCheckDespesaChange($event.target.checked, despesa)">
                      <span class="checkmark"></span>
                    </label>
                  </th>

                  <td>
                    <span *ngIf="despesa.tpLinhaSeparacao == 'N'">
                      <span>
                        {{despesa.svlTotalDespesa}}
                      </span>
                    </span>
                  </td>

                  <td class="text-right" *ngIf="despesa.tpLinhaSeparacao == 'N'">
                    <span class="text-info" *ngIf="despesa.statusPercentual == 'Baixo'">
                      <i class="fas fa-caret-down me-1"></i><span>{{ despesa.percentualUtilizacao}}</span>
                    </span>
                    <span class="text-success" *ngIf="despesa.statusPercentual == 'Medio'">
                      <i class="fas fa-caret-down me-1"></i><span>{{ despesa.percentualUtilizacao}}</span>
                    </span>
                    <span class="text-warning" *ngIf="despesa.statusPercentual == 'Alto'">
                      <i class="fas fa-caret-up me-1"></i><span>{{ despesa.percentualUtilizacao}}</span>
                    </span>
                    <span class="text-danger" *ngIf="despesa.statusPercentual == 'Altissimo'">
                      <i class="fas fa-caret-up me-1"></i><span>{{ despesa.percentualUtilizacao}}</span>
                    </span>
                  </td>

                  <td class="font-weight-bold" data-toggle="modal" data-target="#modalDetalheDespesasMensais"
                    (click)="carregarDetalheDespesa(despesa.idDespesa, despesa.idDetalheDespesa, despesa.idOrdemExibicao)">
                    {{ despesa.dsTituloDespesa }}
                  </td>

                  <td>
                    <span *ngIf="despesa.statusPagamento == 'Pendente' && despesa.tpRelatorio !== 'S' && despesa.tpEmprestimo !== 'S' 
                    && despesa.tpAnotacao !== 'S'" class="badge badge-warning rounded-pill d-inline">Á Pagar
                    </span>
                    <span *ngIf="despesa.statusPagamento == 'Pago' && despesa.tpRelatorio !== 'S' && despesa.tpEmprestimo !== 'S' 
                      && despesa.tpAnotacao != 'S'" class="badge badge-success rounded-pill d-inline">Pago
                      <i class="fa fa-check" aria-hidden="true"></i>
                    </span>
                    <span *ngIf="despesa.tpRelatorio == 'S'" class="badge badge-info d-inline rounded-pill d-inline"
                      style="background-color: #8a6b16;">Relatório
                      <!--<i class="fa fa-file-text" aria-hidden="true"></i>-->
                    </span>
                    <span *ngIf="despesa.tpEmprestimo == 'S'" class="badge badge-info d-inline rounded-pill d-inline"
                      style="background-color: #6c0b75;">Empréstimo
                      <!--<i class="fa fa-money" aria-hidden="true"></i>-->
                    </span>
                    <span *ngIf="despesa.tpAnotacao == 'S'" class="badge badge-info d-inline rounded-pill d-inline"
                      style="background-color: #2988a5;">Rascunho
                      <!--<i class="fa fa-sticky-note-o" aria-hidden="true"></i>-->
                    </span>
                  </td>

                  <td>{{ despesa.svlTotalDespesaPaga }}</td>

                  <td *ngIf="despesa.tpLinhaSeparacao == 'S'"></td>
                  <td class="text-left">
                    <button *ngIf="despesa.tpLinhaSeparacao == 'S'" type="button" disabled
                      class="btn btn-link btn-sm px-0">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button *ngIf="despesa.tpLinhaSeparacao == 'N'" type="button" class="btn btn-link btn-sm px-0"
                      data-toggle="modal" data-target="#modalDetalheDespesasMensais"
                      (click)="carregarDetalheDespesa(despesa.idDespesa, despesa.idDetalheDespesa, despesa.idOrdemExibicao)"
                      title="Editar despesa">
                      <i class="fas fa-edit"></i>
                    </button>
                    <button type="button" class="btn btn-link btn-sm px-0" title="Subir item"
                      (click)="subirLinhaDespesa(despesa)">
                      <i class="fa fa-chevron-up"></i>
                    </button>
                    <button type="button" class="btn btn-link btn-sm px-0" title="Descer item"
                      (click)="descerLinhaDespesa(despesa)">
                      <i class="fa fa-chevron-down"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
              <tr>
                <th></th>
                <td colspan="7">
                  <br>
                  <div class="d-grid gap-2 d-md-block btn-group-sm">
                    <span *ngIf="lancamentosFinanceiros$.vlSaldoDisponivelMes =='0,00'">
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #3b6bd3;"
                        role="button" data-toggle="modal" data-target="#ModalDetalheDespesasMensais"
                        (click)="onNovaDespesa()">
                        <i class="fas fa-plus"></i> Criar Nova Despesa
                      </button>
                    </span>

                    <span *ngIf="lancamentosFinanceiros$.vlSaldoDisponivelMes !='0,00'">
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #3b6bd3;"
                        role="button" data-toggle="modal" data-target="#modalDetalheDespesasMensais"
                        (click)="onNovaDespesa()">
                        <i class="fas fa-plus"></i> Nova Despesa
                      </button>
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #ee5569;" href="#!"
                        role="button" (click)="onExcluirDespesa()">
                        <i class="fas fa-trash-alt"></i> Excluir Despesa
                      </button>
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #58c069;" href="#!"
                        role="button" (click)="onQuitarDespesa()">
                        <i class="far fa-calendar-check"></i> Pagar Despesa
                      </button>
                      <button class="btn text-white" data-mdb-ripple-init style="background-color: #d38a8a;" href="#!"
                        role="button" (click)="onNovaLinhaSeparacao()">
                        <i class="fas fa-bars"></i> Nova Linha
                      </button>
                    </span>
                  </div>
                </td>
                <td></td>
                <td></td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
  </body>

  <!------------------------  Modal Editar Receita ------------------------>
  <div class="modal fade" id="modalCriarEditarReceita" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
      <div class="modal-content modalCriarEditarReceita">
        <form [formGroup]="modalCriarEditarReceitaForm">
          <div class="form-group modal-body">
            <label>Titulo da Receita:</label>
            <input class="form-control form-control-sm" type="text" formControlName="nomeReceita"
              placeholder="Ex: Convênio médico" onkeyup="toUpper(this)">

            <label>Valor R$:</label>
            <input class="form-control text-left form-control-sm" [formControl]="valorReceitaControl" currencyMask
              maxlength="16" autocomplete="off" [options]="{ prefix: 'R$ ', thousands: '.', decimal: ',' }"
              placeholder="Ex: 500,00">

            <label>Categoria</label>
            <select class="form-control form-control-sm" formControlName="tipoReceita">
              <option value="+">Receita ( + )</option>
              <option value="-">Despesa ( - )</option>
              <option value="< X >">Linha Separacao</option>
              <option value="< i >">Anotação ( i )</option>
              <option value="P(+)">Poupança Positiva ( P+ )</option>
              <option value="P(-)">Poupança Negativa ( P- )</option>
              <option value="->">Reserva Mês Seguinte ( -> )</option>
            </select>

            <div class="row">
              <br>
              <div class="form-check-inline checkDespesaObrigatoria">
                <input class="form-check-input" type="checkbox" formControlName="checkDespesaObrigatoria"
                  id="chkDespesaObrigatoria">
                <label class="form-check-label" for="chkDespesaObrigatoria"
                  style="font-size: smaller; color: #a7444e!important"
                  title="Classifica o item como obrigatório para contabilizar na Despesa\Receita.">*Despesa\Receita
                  obrigatória.</label>
              </div>
            </div>

          </div>
        </form>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" data-dismiss="modal" style="background-color: #3b6bd3;"
            (click)="gravarReceita()">
            <i class="fa fa-floppy-o"></i> Salvar
          </button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!------------------------  Modal Confirmação - Excluir Despesa ------------------------>
  <ng-template #modalConfirmacaoExcluirDespesa>
    <div class="modal-header">
      <h6 class="modal-title">
        <i class="fa fa-question-circle-o" style="font-size: 130%;" aria-hidden="true"></i>
        Confirmação
      </h6>
      <button type="button" class="close" data-dismiss="modal" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="modal-body">
      Deseja realmente excluir a(s) despesa(s) selecionada(s)?
      <small class="form-text" style="font-size: revert; color: #a7444e!important">
        <i class="fa fa-info-circle" aria-hidden="true"></i>
        Atenção: Esta ação não podera ser desfeita.
      </small>
      <br>
    </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="confirmExcluirDespesas()">Sim</button>
      <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeModal()">Não</button>
    </div>
  </ng-template>

  <!------------------------  Modal Confirmação - Generico ------------------------>
  <form>
    <ng-template #modalConfirmacaoEventos>
      <div class="modal-header">
        <h6 class="modal-title">
          <i class="fa fa-question-circle" style="font-size: 130%;" aria-hidden="true"></i> Confirmação
        </h6>
      </div>
      <div class="form-group modal-body">
        {{mensagemModalConfirmacao}}
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-primary" data-dismiss="modal" (click)="confirmEventModal()">Sim</button>
        <button type="button" class="btn btn-secondary" data-dismiss="modal" (click)="closeModal()">Não</button>
      </div>
    </ng-template>
  </form>

  <button class="btn text-white" data-mdb-ripple-init style="background-color: #3b056e;" href="#!"
                    role="button" title="Cadastro Despesas Parceladas" data-toggle="modal"
                    data-target="#modalDespesasParceladas">
                    <i class="fa fa-credit-card"></i>
                  </button>